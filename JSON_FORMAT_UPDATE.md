# JSON Format Compatibility Update

## Issue
The Python conversion script was failing to process new JSON files generated by the extension's auto-export feature.

## Root Cause
The extension generates JSON in a different format than the original manual exports:

**Old Format (Manual Export):**
```json
{
  "responseInfo": {...},
  "totalResults": 152,
  "orderDetailsList": [
    {...order1...},
    {...order2...}
  ]
}
```

**New Format (Auto-Export from Extension):**
```json
{
  "page": 2,
  "orderType": "online",
  "orders": [
    {...order1...},
    {...order2...}
  ],
  "totalResults": 11,
  "fetchedAt": "2025-10-17T00:41:13.584Z"
}
```

## Solution
Updated `convert_orders.py` to handle both formats by checking for both `orderDetailsList` and `orders` keys:

```python
# Extract orders from the JSON structure (handle both old and new formats)
# Old format: { "orderDetailsList": [...] }
# New format: { "page": 2, "orders": [...], "fetchedAt": "..." }
orders = data.get('orderDetailsList', [])
if not orders:
    orders = data.get('orders', [])
```

## Test Results

### Before Fix
```
Error: No orders found in orders-page-2.json
```

### After Fix
```
Found 9 JSON file(s):
  - orders-instore-page-4.json
  - orders-instore-page-5.json
  - orders-instore-page-2.json
  - orders-instore-page-3.json
  - orders-page-1.json ✨ NEW FORMAT
  - orders-page-2.json ✨ NEW FORMAT
  - orders-instore-page-1.json
  - orders-instore-page-6.json
  - orders-instore-page-7.json

Processing all 9 files...
✅ Extracted 188 orders
✅ Generated 300 rows (including line items)
```

## File Naming Patterns

The extension auto-exports JSON with these naming patterns:

- **In-Store Orders**: `orders-instore-page-N.json`
- **Online Orders**: `orders-page-N.json`

Where `N` is the page number (1, 2, 3, etc.)

## Usage

The script now automatically works with both formats - no changes needed:

```bash
python3 convert_orders.py
```

It will:
1. Find all `.json` files in the `data/` directory
2. Detect which format each file uses
3. Extract orders regardless of format
4. Generate combined TSV and XLSX outputs

## Benefits

✅ **Backward Compatible**: Still works with old manual exports
✅ **Forward Compatible**: Works with new auto-export format
✅ **Automatic Detection**: No manual configuration needed
✅ **Combined Output**: Merges data from all JSON files regardless of format

## Files Modified

- `convert_orders.py` - Added dual-format support (lines 226-231)

---

**Updated**: October 16, 2025
**Tested With**: 9 JSON files (both old and new formats)
**Result**: ✅ All formats processed successfully
